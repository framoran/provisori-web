<h1 class="title"><i class="fas fa-tools fa-2x"></i> Contruire son article </h1>

<div class="half-page">
  <div class="card">
    <div class="card-content">
      <div class="media">
        <div class="media-left">
          <figure class="image is-48x48">
            <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
          </figure>
        </div>
        <div class="media-content"><br>
          <h1 class="title"><%= @article.title %> </h1>
          <p class="subtitle is-6">Thomas Pfefferlé</p>
        </div>
      </div>

      <br>
      </span>

      <div id="new_elements">

        <% if @article.elements.present?

          @article.elements.each do |element| %>

            <%= render partial: 'elements', locals: { element: element } %>

          <% end %>

        <% end %>

        <div id="childElement"></div>

      </div>
      <br>

      <div class="ml-3">
        <h3 class="subtitle">
          <i class="fas fa-wrench fa-2x"> </i> Outils
        </h3>
      </div>

      <div class="is-flex is-justify-content-start-flex">

        <div class="mt-3 ml-3">
          <button id="add" type="button" class="button is-black">+ Ajouter paragraphe</button>
        </div>

        <div class="mt-3  ml-3">
          <button id="add-subtitle1" type="button" class="button is-black">+ Ajouter titre</button>
        </div>

      </div>

      <div class="is-flex is-justify-content-start-flex">

        <div class="mt-3 ml-3">
          <button id="add-subtitle2" type="button" class="button is-black">+ Ajouter un sous-titre</button>
        </div>

      </div>

      <div class="is-flex is-justify-content-space-flex">

        <div class="mt-3  ml-3">
          <button id="add-image" type="button" class="button is-black">+ Ajouter image</button>
        </div>

        <div class="mt-3  ml-3">
          <button id="add-video" type="button" class="button is-black">+ Ajouter video</button>
        </div>

      </div>

      <hr>

      <div class="is-flex is-justify-content-space-between	">

        <div class="mt-3 ml-5">
          <%= link_to 'Preview', article_path(article), class: 'button is-info' %>
        </div>

        <div class="mt-3 ml-5">
          <%= link_to 'Annuler', articles_path, class: 'button is-danger' %>
        </div>

      </div>

    </div>

  </div>

</div>

<script>

  save = false;

  function insert(type_of_element){

    if (save){

      alert("Vous devez d'abord sauvegarder votre travail");

    }else{

      save = true;

      switch (type_of_element) {
        case 'body':
          element = 'textarea';
          element_placeholder = 'texte...';
          element_class="mt-5 body";
          element_name = type_of_element;
          break;
        case 'subtitle1':
          element = 'input';
          element_placeholder = 'Sous-titre 1';
          element_class="mt-5 title";
          element_name = type_of_element;
          break;
        case 'subtitle2':
          element = 'input';
          element_placeholder = 'Sous-titre 2';
          element_class="mt-5 subtitle";
          element_name = type_of_element;
          break;
        case 'video':
          element = 'input';
          element_placeholder = "Insérer l'URL de la vidéo";
          element_class="mt-5 is-size-6";
          element_name = "src";
          break;
        case 'image':
          element = 'input';
          element_placeholder = "Insérer l'URL de l'image";
          element_class="mt-5 is-size-6";
          element_name = "src";
          break;
        default:
          element = 'textarea';
          element_placeholder = 'texte...';
          element_class="mt-5 body";
      }

      const childElement = document.getElementById("childElement");

      const form = document.createElement("form");
      form.className = "media-content";
      form.action = "/articles/<%= params[:id] %>/elements";
      form.method = "post";

      var hidden_input = document.createElement("input");
      hidden_input.name="authenticity_token";
      hidden_input.type="hidden";
      hidden_input.value="<%= form_authenticity_token  %>";

      var hidden_input_type = document.createElement("input");
      hidden_input_type.name="article[elements_type]";
      hidden_input_type.type="hidden";
      hidden_input_type.value=type_of_element;

      var label = document.createElement("label");
      label.className = "label-elements";
      label.id  = "article["+type_of_element+"]";

      var alt = document.createElement(element);
      alt.name  = "article[alt]";
      alt.className = element_class;
      alt.placeholder = "Insérer un descriptif à l'image";

      var body = document.createElement(element);
      body.name  = "article["+element_name+"]";
      body.className = element_class;
      body.placeholder = element_placeholder;
      body.appendChild(document.createTextNode(element_placeholder));

      form.appendChild(hidden_input);
      form.appendChild(hidden_input_type);
      form.appendChild(label);

      if(type_of_element == "image"){
        form.appendChild(alt);
      }

      form.appendChild(body);

      var save_btn = document.createElement("button");
      save_btn.textContent = "Sauvegarder";
      save_btn.type = "Submit";
      save_btn.onclick = function(){
        save_btn.className = "button is-primary";
        save_btn.textContent = "Sauvegardé";
        save = false;
      };
      save_btn.className = "button is-danger";
      form.appendChild(save_btn);

      let parentForm = document.getElementById("childElement").parentNode;

      parentForm.insertBefore(form, childElement);

    }

  }

  document.getElementById('add').onclick = function(){

    insert("body");

  }

  document.getElementById('add-subtitle1').onclick = function(){

    insert("subtitle1");

  }

  document.getElementById('add-subtitle2').onclick = function(){

    insert("subtitle2");

  }

  document.getElementById('add-video').onclick = function(){

    insert("video");

  }

  document.getElementById('add-image').onclick = function(){

    insert("image");

  }

</script>
